set USAGE "
 [info script] converting SHP polygon file to poly format (Osmosis polygon filter file formatn). 
USAGE:
 tclsh [info script] path/to/file.shp

 Example:
   tclsh [info script] $::env(HOME)/projectsdata/dq/psi/pilotsites.shp
 Links:
   https://wiki.openstreetmap.org/wiki/Osmosis/Polygon_Filter_File_Format
 See also *.poly file usage with osm-history-splitter at the end of this file
"

if {$argc ne 1} {
    puts "Error! Wrong number of paramenters (shoud be 1 exacly). \n\n$USAGE"
    exit 1
} else {
    set shape_polygons $argv
    set polygons ""
    foreach line [split [exec ogrinfo -al $shape_polygons] \n] {
	if {[lsearch $line POLYGON]>-1} {
	    lappend polygons [string trim $line]
	}
    }
    foreach p $polygons {
	puts "none\n[expr {[lsearch $polygons $p]+1}]"
	set p [string range $p [expr {[string first "(" $p]+2}] end-2]
	foreach coor [split $p ,] {
	    puts "[format %.6e [lindex $coor 0]] [format %.6e [lindex $coor 1]]"
	}
	puts "END\nEND"
	       
	
    }
}



if 0 {
    # Data and usage with osm-history-splitter (https://github.com/MaZderMind/osm-history-splitter)

    /home/local/src/osm-history-splitter/osm-history-splitter history-latest.osh.bz2 histcurrent.cnfg
    #Do not foget to rename history-latest.osm.bz2 to history-latest.osh.bz2 !!!

    # The content of histcurrent.cnfg:
sandona.osh.bz2    POLY    sandona.poly
southwark.osh.bz2    POLY    southwark.poly
turin.osh.bz2    POLY    turin.poly
israel.osh.bz2    POLY    israel.poly
hd.osh.bz2    POLY    hd.poly

   # The concatenated contend of sandona.poly turin.poly southwark.poly hd.poly israel.poly files:
none
1
1.257614e+01 4.569903e+01
1.259909e+01 4.568457e+01
1.259909e+01 4.568457e+01
1.259593e+01 4.567575e+01
1.260125e+01 4.566661e+01
1.260458e+01 4.566362e+01
1.261322e+01 4.566894e+01
1.262337e+01 4.567659e+01
1.262769e+01 4.567509e+01
1.262686e+01 4.566944e+01
1.262835e+01 4.566046e+01
1.263833e+01 4.566012e+01
1.264465e+01 4.566312e+01
1.265828e+01 4.565281e+01
1.266311e+01 4.564200e+01
1.266028e+01 4.563784e+01
1.264797e+01 4.563252e+01
1.262137e+01 4.563585e+01
1.262287e+01 4.562870e+01
1.263600e+01 4.561856e+01
1.263068e+01 4.560924e+01
1.264282e+01 4.560259e+01
1.263617e+01 4.559095e+01
1.262021e+01 4.557815e+01
1.261422e+01 4.557433e+01
1.260225e+01 4.557566e+01
1.259427e+01 4.557649e+01
1.258978e+01 4.557882e+01
1.258579e+01 4.558015e+01
1.258163e+01 4.557765e+01
1.257681e+01 4.557715e+01
1.257415e+01 4.558048e+01
1.256401e+01 4.557882e+01
1.256467e+01 4.557383e+01
1.256899e+01 4.556751e+01
1.257747e+01 4.556235e+01
1.258180e+01 4.555803e+01
1.257614e+01 4.555288e+01
1.256234e+01 4.556651e+01
1.255835e+01 4.557283e+01
1.255187e+01 4.557483e+01
1.254921e+01 4.558048e+01
1.254838e+01 4.558414e+01
1.255869e+01 4.558913e+01
1.256766e+01 4.559661e+01
1.257016e+01 4.560542e+01
1.257132e+01 4.561423e+01
1.257099e+01 4.562138e+01
1.256201e+01 4.562454e+01
1.255669e+01 4.562853e+01
1.254804e+01 4.563069e+01
1.253092e+01 4.563252e+01
1.252676e+01 4.563485e+01
1.252260e+01 4.564749e+01
1.252011e+01 4.564932e+01
1.252892e+01 4.565297e+01
1.253208e+01 4.565015e+01
1.253607e+01 4.565081e+01
1.253790e+01 4.565331e+01
1.255403e+01 4.566378e+01
1.256201e+01 4.566245e+01
1.256085e+01 4.567276e+01
1.256583e+01 4.567775e+01
1.257082e+01 4.568739e+01
1.257016e+01 4.569454e+01
1.257614e+01 4.569903e+01
END
END
none
2
7.594061e+00 4.504258e+01
7.612019e+00 4.503277e+01
7.617672e+00 4.503526e+01
7.613848e+00 4.503909e+01
7.617839e+00 4.505023e+01
7.623991e+00 4.505472e+01
7.624988e+00 4.505755e+01
7.617007e+00 4.505971e+01
7.610855e+00 4.506636e+01
7.604038e+00 4.506952e+01
7.605035e+00 4.507683e+01
7.613017e+00 4.507633e+01
7.609691e+00 4.508265e+01
7.613515e+00 4.508964e+01
7.624323e+00 4.508714e+01
7.626984e+00 4.509130e+01
7.619002e+00 4.509296e+01
7.612019e+00 4.510061e+01
7.611853e+00 4.510377e+01
7.622494e+00 4.510194e+01
7.621663e+00 4.511491e+01
7.649930e+00 4.511358e+01
7.650761e+00 4.511042e+01
7.653421e+00 4.511075e+01
7.653421e+00 4.511291e+01
7.649763e+00 4.511923e+01
7.655084e+00 4.512539e+01
7.663897e+00 4.511375e+01
7.671711e+00 4.511325e+01
7.671711e+00 4.510843e+01
7.685512e+00 4.510859e+01
7.686177e+00 4.511059e+01
7.694990e+00 4.510793e+01
7.696154e+00 4.511225e+01
7.686177e+00 4.511707e+01
7.697151e+00 4.511990e+01
7.700311e+00 4.511724e+01
7.703802e+00 4.511890e+01
7.702306e+00 4.512173e+01
7.699646e+00 4.512805e+01
7.703636e+00 4.513453e+01
7.719100e+00 4.513287e+01
7.715442e+00 4.512023e+01
7.711119e+00 4.511425e+01
7.711119e+00 4.510776e+01
7.707959e+00 4.510277e+01
7.720596e+00 4.510078e+01
7.733566e+00 4.511807e+01
7.739551e+00 4.511957e+01
7.733898e+00 4.510876e+01
7.739551e+00 4.510261e+01
7.744207e+00 4.510443e+01
7.754516e+00 4.509828e+01
7.738886e+00 4.509296e+01
7.742378e+00 4.508914e+01
7.756511e+00 4.508565e+01
7.769813e+00 4.508648e+01
7.775301e+00 4.508066e+01
7.735395e+00 4.504275e+01
7.726416e+00 4.503892e+01
7.727413e+00 4.503294e+01
7.712781e+00 4.502728e+01
7.697650e+00 4.502895e+01
7.691997e+00 4.502795e+01
7.680690e+00 4.502629e+01
7.680524e+00 4.501731e+01
7.659075e+00 4.501531e+01
7.654751e+00 4.501132e+01
7.657412e+00 4.500733e+01
7.634632e+00 4.500916e+01
7.629644e+00 4.500750e+01
7.622162e+00 4.500733e+01
7.603040e+00 4.501664e+01
7.601544e+00 4.502961e+01
7.586246e+00 4.503992e+01
7.588408e+00 4.504341e+01
7.594061e+00 4.504258e+01
END
END
none
3
-1.321213e-01 5.152499e+01
-1.339115e-02 5.152477e+01
-1.295745e-02 5.141117e+01
-1.319079e-01 5.141155e+01
-1.321213e-01 5.152499e+01
END
END
none
4
8.604500e+00 4.946030e+01
8.819900e+00 4.946190e+01
8.820600e+00 4.931390e+01
8.607700e+00 4.931350e+01
8.604500e+00 4.946030e+01
END
END
none
1
3.376790e+01 3.345959e+01
3.606894e+01 3.345959e+01
3.619821e+01 2.930049e+01
3.386486e+01 2.927794e+01
END
END

}
